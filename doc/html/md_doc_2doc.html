<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fileserver: Documentation technique</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Fileserver
   </div>
   <div id="projectbrief">A fileserver in c with its python client</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_doc_2doc.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Documentation technique</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Sommaire</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Code Client</h2>
<ul>
<li>Fonctionnalités</li>
<li>Fonctions</li>
<li>Fonctionnement</li>
<li>Utilisation</li>
<li>Dépendances</li>
</ul>
<h2><a class="anchor" id="autotoc_md3"></a>
Code Serveur</h2>
<ul>
<li>Fonctionnalités</li>
<li>Fonctions Principales</li>
<li>Utilisation</li>
<li>Fonctionnement</li>
<li>Dépendances</li>
</ul>
<h2><a class="anchor" id="autotoc_md4"></a>
Protocole</h2>
<ul>
<li>Connexion client/serveur</li>
<li>Échange de données</li>
<li>Requête pwd</li>
<li>Requête list</li>
<li>Requête cd</li>
<li>Requête mkdir</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md6"></a>
Code Client (Python)</h1>
<h2><a class="anchor" id="autotoc_md7"></a>
Fonctionnalités</h2>
<h3><a class="anchor" id="autotoc_md8"></a>
Découverte des serveurs</h3>
<ul>
<li>Découverte des serveurs disponibles sur le réseau local via une diffusion UDP.</li>
<li>Recherche des serveurs sur le réseau local hébergeant un fichier spécifique.</li>
</ul>
<h3><a class="anchor" id="autotoc_md9"></a>
Gestion des commandes</h3>
<ul>
<li>Cartographie dynamique et exécution des commandes côté client.</li>
<li>Vérification des arguments des commandes avant de les envoyer au serveur.</li>
</ul>
<h3><a class="anchor" id="autotoc_md10"></a>
Communication par socket</h3>
<ul>
<li>Création de sockets TCP pour la communication client-serveur.</li>
<li>Création d'un socket UDP pour entrer en contact avec les serveurs.</li>
</ul>
<h3><a class="anchor" id="autotoc_md11"></a>
Gestion des fichiers et répertoires</h3>
<ul>
<li>Upload de fichiers et répertoires vers le serveur connecté.</li>
<li>Download de fichiers et répertoires depuis le serveur connecté.</li>
<li>Navigation dans les répertoires côté client et côté serveur.</li>
<li>Création de répertoire côté client et côté serveur.</li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md13"></a>
Fonctions</h2>
<h3><a class="anchor" id="autotoc_md14"></a>
<code>create_socket()</code></h3>
<p>Crée et retourne un socket TCP.</p>
<ul>
<li><b>Retourne</b> : <code>client_socket</code> - Le socket créé pour la communication.</li>
<li><b>Gestion des erreurs</b> : Quitte le programme et prévient l'utilisateur de l'erreur en cas d'échec de la création du socket.</li>
</ul>
<h3><a class="anchor" id="autotoc_md15"></a>
<code>connect_socket(client_socket, host, port)</code></h3>
<p>Connecte le socket donné à un hôte et un port spécifiques.</p>
<ul>
<li><b>Paramètres</b> :<ul>
<li><code>client_socket</code> : Le socket TCP.</li>
<li><code>host</code> (str) : Adresse IP du serveur.</li>
<li><code>port</code> (int) : Numéro du port.</li>
</ul>
</li>
<li><b>Gestion des erreurs</b> : Quitte le programme et prévient l'utilisateur de l'erreur en cas d'échec de la connexion.</li>
</ul>
<h3><a class="anchor" id="autotoc_md16"></a>
<code>handle_command(client_socket, message)</code></h3>
<p>Traite une commande utilisateur et utilise la fonction appropriée depuis <code>cmd_h.command_map</code>.</p>
<ul>
<li><b>Paramètres</b> :<ul>
<li><code>client_socket</code> : Le socket client actif.</li>
<li><code>message</code> (str) : La commande saisie par l'utilisateur.</li>
</ul>
</li>
<li><b>Comportement</b> :<ul>
<li>Divise le message en parties.</li>
<li>Associe la commande à <code>cmd_h.command_map</code> et exécute la fonction correspondante.</li>
<li>Affiche un message d'erreur si la commande est introuvable, le programme continue son exécution normalement.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md17"></a>
<code>discover_servers(broadcast_port)</code></h3>
<p>Découvre les serveurs sur le réseau local via une diffusion UDP.</p>
<ul>
<li><b>Paramètres</b> :<ul>
<li><code>broadcast_port</code> (int) : Le numéro de port pour la diffusion de la requête de découverte.</li>
</ul>
</li>
<li><b>Retourne</b> : Liste des réponses des serveurs.</li>
<li><b>Comportement</b> :<ul>
<li>Diffuse un message de découverte (<code>DISCOVER_SERVER</code>).</li>
<li>Attend des réponses des serveurs.</li>
<li>Affiche et collecte les réponses.</li>
<li>Gère le timeout si aucun serveur ne répond.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md18"></a>
<code>discover_servers_from_file(broadcast_port, filename)</code></h3>
<p>Découvre les serveurs hébergeant un fichier spécifique sur le réseau local.</p>
<ul>
<li><b>Paramètres</b> :<ul>
<li><code>broadcast_port</code> (int) : Le numéro de port pour la diffusion de la requête.</li>
<li><code>filename</code> (str) : Le fichier à rechercher sur les serveurs.</li>
</ul>
</li>
<li><b>Retourne</b> : Liste des réponses des serveurs.</li>
<li><b>Comportement</b> :<ul>
<li>Diffuse un message de découverte <code>FILE_DISCOVER_SERVER</code> et le nom du fichier.</li>
<li>Attend des réponses et les collecte.</li>
<li>Gère le timeout si aucun serveur ne répond.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md19"></a>
<code>broadcast()</code></h3>
<p>Lance la découverte des serveurs et permet à l'utilisateur de se connecter à un serveur découvert.</p>
<ul>
<li><b>Retourne</b> : Le socket connecté ou <code>0</code> si aucun serveur n'est trouvé.</li>
<li><b>Comportement</b> :<ul>
<li>Appelle <code>discover_servers</code>.</li>
<li>Affiche la liste des serveurs découverts.</li>
<li>Invite l'utilisateur à sélectionner un serveur auquel se connecter.</li>
<li>Prévient l'utilisateur si aucun serveur n'a répondu.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md20"></a>
<code>find_server_from_file()</code></h3>
<p>Lance une recherche de serveurs hébergeant un fichier spécifique et permet à l'utilisateur de se connecter à l'un d'eux.</p>
<ul>
<li><b>Retourne</b> : Le socket connecté ou <code>0</code> si aucun serveur n'est trouvé.</li>
<li><b>Comportement</b> :<ul>
<li>Invite l'utilisateur à entrer un nom de fichier.</li>
<li>Appelle <code>discover_servers_from_file</code>.</li>
<li>Affiche la liste des serveurs hébergeant le fichier.</li>
<li>Invite l'utilisateur à sélectionner un serveur auquel se connecter.</li>
<li>Prévient l'utilisateur si aucun serveur n'a répondu.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md21"></a>
<code>main()</code></h3>
<p>Point d'entrée du programme. Gère l'interaction avec l'utilisateur.</p>
<ul>
<li><b>Comportement</b> :<ul>
<li>Invite l'utilisateur à choisir une méthode de découverte des serveurs :<ol type="1">
<li>Découverte générale (<code>broadcast</code>).</li>
<li>Découverte spécifique à un fichier (<code>find_server_from_file</code>).</li>
</ol>
</li>
<li>Établit une connexion au serveur sélectionné.</li>
<li>Entre dans une boucle pour traiter les commandes de l'utilisateur.</li>
<li>Quitte le programme proprement en cas d'interruption clavier.</li>
</ul>
</li>
</ul>
<hr  />
<h3><a class="anchor" id="autotoc_md23"></a>
Gestion des commandes</h3>
<p>Le dictionnaire suivant mappe les commandes à leurs fonctions :</p>
<div class="fragment"><div class="line">command_map = {</div>
<div class="line">    <span class="stringliteral">&#39;help&#39;</span> : handle_help,</div>
<div class="line">    <span class="stringliteral">&#39;cd&#39;</span> : handle_cd,</div>
<div class="line">    <span class="stringliteral">&#39;list&#39;</span> : handle_list,</div>
<div class="line">    <span class="stringliteral">&#39;mkdir&#39;</span> : handle_mkdir,</div>
<div class="line">    <span class="stringliteral">&#39;pwd&#39;</span> : handle_pwd,</div>
<div class="line">    <span class="stringliteral">&#39;download&#39;</span> : handle_download,</div>
<div class="line">    <span class="stringliteral">&#39;upload&#39;</span> : handle_upload,</div>
<div class="line">    <span class="stringliteral">&#39;lcd&#39;</span> : handle_lcd,</div>
<div class="line">    <span class="stringliteral">&#39;llist&#39;</span> : handle_llist,</div>
<div class="line">    <span class="stringliteral">&#39;lmkdir&#39;</span> : handle_lmkdir,</div>
<div class="line">    <span class="stringliteral">&#39;lpwd&#39;</span> : handle_lpwd</div>
<div class="line">}</div>
</div><!-- fragment --><p><b>Commandes disponibles :</b></p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Commande   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>help</code>   </td><td class="markdownTableBodyNone">Affiche la liste des commandes disponibles ou des détails sur une commande spécifique.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>list</code>   </td><td class="markdownTableBodyNone">Liste les fichiers dans le répertoire courant du serveur.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>llist</code>   </td><td class="markdownTableBodyNone">Liste les fichiers dans le répertoire courant du client.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>pwd</code>   </td><td class="markdownTableBodyNone">Affiche le répertoire courant du serveur.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>lpwd</code>   </td><td class="markdownTableBodyNone">Affiche le répertoire courant du client.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>cd</code>   </td><td class="markdownTableBodyNone">Accède à un répertoire donné sur le serveur.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>lcd</code>   </td><td class="markdownTableBodyNone">Accède à un répertoire donné sur le client.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>mkdir</code>   </td><td class="markdownTableBodyNone">Crée un répertoire sur le serveur.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>lmkdir</code>   </td><td class="markdownTableBodyNone">Crée un répertoire sur le client.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>download</code>   </td><td class="markdownTableBodyNone">Télécharge un fichier/répertoire depuis le serveur vers le client.    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>upload</code>   </td><td class="markdownTableBodyNone">Transfère un fichier/répertoire depuis le client vers le serveur.   </td></tr>
</table>
<hr  />
<h2><a class="anchor" id="autotoc_md25"></a>
Fonctionnement</h2>
<ol type="1">
<li><b>Saisie utilisateur</b> :<ul>
<li>L'utilisateur choisit une méthode de découverte (générale ou spécifique à un fichier).</li>
<li>Saisit des commandes après une connexion réussie.</li>
</ul>
</li>
<li><b>Découverte des serveurs</b> :<ul>
<li>Diffuse des messages de découverte via UDP.</li>
<li>Affiche les serveurs disponibles et permet une sélection par l'utilisateur.</li>
</ul>
</li>
<li><b>Communication par socket</b> :<ul>
<li>Établit une connexion TCP au serveur sélectionné.</li>
<li>Envoie des commandes et traite les réponses.</li>
</ul>
</li>
<li><b>Gestion des commandes</b> :<ul>
<li>Les commandes sont traitées dynamiquement via <code>cmd_h.command_map</code>.</li>
</ul>
</li>
<li><b>Gestion des erreurs</b> :<ul>
<li>Gère les erreurs de création et de connexion de socket.</li>
<li>Traite les erreurs de saisie des commandes et les commandes inconnues.</li>
</ul>
</li>
</ol>
<hr  />
<h2><a class="anchor" id="autotoc_md27"></a>
Utilisation</h2>
<h3><a class="anchor" id="autotoc_md28"></a>
Exécution du script</h3>
<p>Exécutez le script en utilisant Python :</p>
<div class="fragment"><div class="line">python client.py</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md29"></a>
Exemples de commandes</h3>
<ul>
<li>Découvrir des serveurs : <div class="fragment"><div class="line">1</div>
</div><!-- fragment --></li>
<li>Rechercher un fichier : <div class="fragment"><div class="line">2</div>
<div class="line">Entrez le nom du fichier&gt;example.txt</div>
</div><!-- fragment --></li>
<li>Exécuter une commande : <div class="fragment"><div class="line">help</div>
</div><!-- fragment --></li>
</ul>
<hr  />
<h2><a class="anchor" id="autotoc_md31"></a>
Dépendances</h2>
<ul>
<li>Python 3.x</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md33"></a>
Code Serveur (C)</h1>
<h2><a class="anchor" id="autotoc_md34"></a>
Fonctionnalités</h2>
<ol type="1">
<li><b>Configuration du serveur</b> :<ul>
<li>Création de sockets TCP et UDP pour gérer les connexions client et les diffusions réseau.</li>
<li>Initialisation des structures du serveur et des événements.</li>
</ul>
</li>
<li><b>Découverte et réponse aux clients</b> :<ul>
<li>Réception des requêtes UDP pour découvrir le serveur (<code>DISCOVER_SERVER</code>) ou localiser un fichier spécifique.</li>
<li>Envoi des réponses aux clients pour indiquer l'état ou la disponibilité.</li>
</ul>
</li>
<li><b>Gestion des connexions client</b> :<ul>
<li>Acceptation de nouvelles connexions client via TCP.</li>
<li>Gestion des sessions client (répertoires de travail, sockets actifs).</li>
</ul>
</li>
<li><b>Manipulation de fichiers et répertoires</b> :<ul>
<li>Téléchargement et envoi de fichiers et répertoires.</li>
<li>Création et gestion des répertoires côté serveur.</li>
</ul>
</li>
<li><b>Événements réseau</b> :<ul>
<li>Traitement des événements asynchrones pour les connexions et les diffusions.</li>
</ul>
</li>
</ol>
<hr  />
<h2><a class="anchor" id="autotoc_md36"></a>
Fonctions Principales</h2>
<h3><a class="anchor" id="autotoc_md37"></a>
Initialisation du serveur</h3>
<ul>
<li><b><code>setup_storage_dir</code></b> : Vérifie et initialise le répertoire de stockage du serveur.</li>
<li><b><code>init</code></b> : Configure les sockets, les adresses, et initialise les événements nécessaires.</li>
<li><b><code>start_event_loop</code></b> : Démarre la boucle principale pour gérer les événements TCP/UDP.</li>
</ul>
<h3><a class="anchor" id="autotoc_md38"></a>
Découverte des serveurs</h3>
<ul>
<li><b><code>on_udp_broadcast</code></b> : Répond aux diffusions UDP pour indiquer la disponibilité du serveur ou des fichiers.</li>
</ul>
<h3><a class="anchor" id="autotoc_md39"></a>
Gestion des clients</h3>
<ul>
<li><b><code>on_accept</code></b> : Accepte une nouvelle connexion client et initialise sa session.</li>
<li><b><code>on_client_data</code></b> : Traite les commandes envoyées par les clients (<code>upload</code>, <code>download</code>, <code>cd</code>, etc.).</li>
</ul>
<h3><a class="anchor" id="autotoc_md40"></a>
Manipulation de fichiers</h3>
<ul>
<li><b><code>write_file</code></b> : Reçoit un fichier d'un client et l'écrit sur le serveur.</li>
<li><b><code>write_directory</code></b> : Reçoit un répertoire et son contenu récursivement.</li>
<li><b><code>send_file_to_client</code></b> : Envoie un fichier au client.</li>
<li><b><code>send_directory</code></b> : Envoie un répertoire (et ses sous-éléments) au client.</li>
</ul>
<h3><a class="anchor" id="autotoc_md41"></a>
Commandes utilisateur</h3>
<ul>
<li><b><code>change_directory</code></b> : Change le répertoire courant de la session client.</li>
<li><b><code>print_working_dir</code></b> : Affiche le répertoire courant du client.</li>
<li><b><code>on_client_data</code></b> : Parse et exécute les commandes <code>upload</code>, <code>download</code>, <code>cd</code>, <code>list</code>, etc.</li>
</ul>
<hr  />
 <h2><a class="anchor" id="autotoc_md43"></a>
Utilisation</h2>
<h3><a class="anchor" id="autotoc_md44"></a>
Exécution du script</h3>
<p>Exécutez le script depuis le répertoire <code>bin</code> :</p>
<div class="fragment"><div class="line">sudo ./server &lt;port&gt; &lt;interface&gt;</div>
</div><!-- fragment --><hr  />
<h2><a class="anchor" id="autotoc_md46"></a>
Fonctionnement</h2>
<ol type="1">
<li><b>Démarrage</b> :<ul>
<li>Initialisation des sockets TCP et UDP, configuration des événements.</li>
<li>Vérification et création du répertoire de stockage si nécessaire.</li>
</ul>
</li>
<li><b>Événements réseau</b> :<ul>
<li>Diffusion UDP pour découvrir le serveur ou des fichiers.</li>
<li>Connexion des clients via TCP pour des opérations spécifiques.</li>
</ul>
</li>
<li><b>Interaction client</b> :<ul>
<li>Réception des commandes (upload, download, cd, pwd).</li>
<li>Exécution des opérations demandées (écriture de fichiers, envoi de répertoires, etc.).</li>
</ul>
</li>
</ol>
<hr  />
<h2><a class="anchor" id="autotoc_md48"></a>
Dépendances</h2>
<ul>
<li><code>libevent</code> : Gestion des événements réseau.</li>
<li>Systèmes Unix (pour les sockets et la manipulation de fichiers).</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md50"></a>
Protocole</h1>
<h2><a class="anchor" id="autotoc_md51"></a>
Connexion client/serveur</h2>
<ol type="1">
<li><b>Requête client</b> :<ul>
<li>Le client envoie une requête <code>DISCOVER_SERVER</code> ou <code>FILE_DISCOVER_SERVER &lt;FILE&gt;</code> sur le socket UDP</li>
<li>Le client attend les réponses des serveurs.</li>
</ul>
</li>
<li><b>Réponse serveur</b> :<ul>
<li>Le serveur répond par <code>&lt;ip_address&gt;:&lt;port&gt;</code> si une requête de type <code>DISCOVER_SERVER</code> a été reçu ou si <code>FILE</code> existe dans son arborescence après le reçu d'une requête <code>FILE_DISCOVER_SERVER &lt;FILE&gt;</code></li>
</ul>
</li>
<li><b>Création du socket TCP</b> :<ul>
<li>Le client choisi le serveur auquel il souhaite se connecter parmi la liste des adresses ip reçu.</li>
<li>Le client envoie la requête de connexion au serveur. </li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md52"></a>
- Le serveur accepte la requête du client.</h1>
<h2><a class="anchor" id="autotoc_md53"></a>
Échange de données</h2>
<ol type="1">
<li><b>Requête client</b> :<ul>
<li>Le client envoie une requête <code>download &lt;file&gt;/&lt;directory</code> ou <code>upload &lt;file&gt;/&lt;directory&gt;</code> depuis le socket TCP.</li>
</ul>
</li>
<li><b>Validation</b> :<ul>
<li>Le serveur reçoit la requête et la valide.</li>
</ul>
</li>
<li><b>Échange de données</b> :<ul>
<li>Le côté upload commence toujours par préciser le type de données avec une requête <code>dir</code> ou <code>file</code>, cette requête est répété à chaque fois nouvelles données lors d'échanges de répertoires.</li>
<li>Le côté download valide le reçu par <code>ACK</code>.</li>
<li>Le côté upload envoie les données du fichier ou du répertoire, puis termine par un <code>END</code> et attend une réponse du client.</li>
<li>Le côté download récupère les données, puis envoie <code>ACK</code> lorsque <code>END</code> est reçu.</li>
<li>Si une requête prend trop de temps à recevoir une réponse, alors elle se renverra automatiquement.</li>
<li>Si un problème survient du côté download, <code>NACK</code> est envoyé et le côté upload renvoie les données. </li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md54"></a>
- Un maximum de 3 renvoie de données est possible par requête.</h1>
<h2><a class="anchor" id="autotoc_md55"></a>
Requête pwd</h2>
<ol type="1">
<li><b>Requête client</b> :<ul>
<li>Le client envoie une requête <code>pwd</code> depuis le socket TCP.</li>
</ul>
</li>
<li><b>Réponse du serveur</b> :<ul>
<li>Le serveur récupère le chemin du répertoire courant de la session client et lui envoie.</li>
<li>En cas d'échec, le serveur envoie l'erreur <code>no_session</code> au client</li>
</ul>
</li>
<li><b>Réponse du client</b> :<ul>
<li>Si le client reçoit <code>no_session</code>, il renvoie la requête <code>pwd</code> jusqu'à un maximum de 3 tentatives. </li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md56"></a>
- Sinon il affiche ce qu'il a reçu du serveur.</h1>
<h2><a class="anchor" id="autotoc_md57"></a>
Requête list</h2>
<ol type="1">
<li><b>Requête client</b> :<ul>
<li>Le client envoie une requête <code>list</code> depuis le socket TCP.</li>
</ul>
</li>
<li><b>Réponse du serveur</b> :<ul>
<li>Le serveur envoie <code>NACK</code> en cas d'erreur</li>
<li>Sinon le serveur envoie chaque fichier et répertoire contenu dans le répertoire courant au client</li>
<li>Envoie <code>END</code> lorsque tout a été envoyé, puis attend la réponse du client</li>
</ul>
</li>
<li><b>Réponse du client</b> :<ul>
<li>Le client renvoie la requête si il reçoit <code>NACK</code> </li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="autotoc_md58"></a>
- Sinon il affiche les fichiers et répertoires du répertoire courant, puis envoie <code>ACK</code> lorsqu'il lit <code>END</code></h1>
<h2><a class="anchor" id="autotoc_md59"></a>
Requête cd</h2>
<ol type="1">
<li><b>Requête client</b> :<ul>
<li>Le client envoie une requête <code>cd &lt;directory&gt;</code> depuis le socket TCP.</li>
</ul>
</li>
<li><b>Réponse du serveur</b> : </li>
</ol>
<h1><a class="anchor" id="autotoc_md60"></a>
- Le serveur modifie le répertoire courant de la session client, puis envoie <code>ACK</code> si il a réussit, une erreur commençant par <code>[-]</code> sinon</h1>
<h2><a class="anchor" id="autotoc_md61"></a>
Requête mkdir</h2>
<ol type="1">
<li><b>Requête client</b> :<ul>
<li>Le client envoie une requête <code>mkdir &lt;directory&gt;</code> depuis le socket TCP.</li>
</ul>
</li>
<li><b>Réponse du serveur</b> :<ul>
<li>Le serveur essaie de créer <code>directory</code> depuis le répertoire courant de la session client.</li>
<li>Le serveur envoie <code>ACK</code> si il a réussit, <code>alr_exists</code> si le répertoire existe déjà.</li>
</ul>
</li>
<li><b>Réponse du client</b> :<ul>
<li>En cas de timeout, le client renvoie la requête jusqu'à 3 tentatives. </li>
</ul>
</li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
