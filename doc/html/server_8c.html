<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Fileserver: src/server.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Fileserver
   </div>
   <div id="projectbrief">A fileserver in c with its python client</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('server_8c.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">server.c File Reference</div></div>
</div><!--header-->
<div class="contents">

<p><a class="el" href="struct_server.html" title="Represents a server instance and its associated data.">Server</a> implementation file.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="server_8h_source.html">../include/server.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1fd601017282ab132c57804ed86e1b94" id="r_a1fd601017282ab132c57804ed86e1b94"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1fd601017282ab132c57804ed86e1b94">setup_storage_dir</a> ()</td></tr>
<tr class="memdesc:a1fd601017282ab132c57804ed86e1b94"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets up the storage directory.  <br /></td></tr>
<tr class="separator:a1fd601017282ab132c57804ed86e1b94"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5a68295ef2b5f09c493e44512719ec84" id="r_a5a68295ef2b5f09c493e44512719ec84"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a5a68295ef2b5f09c493e44512719ec84">init</a> (<a class="el" href="struct_server.html">Server</a> *server, int port, const char *interface)</td></tr>
<tr class="memdesc:a5a68295ef2b5f09c493e44512719ec84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the server.  <br /></td></tr>
<tr class="separator:a5a68295ef2b5f09c493e44512719ec84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca795a02a79de001918ead83c14187d0" id="r_aca795a02a79de001918ead83c14187d0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structclient__session.html">client_session</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aca795a02a79de001918ead83c14187d0">get_client_session_by_socket</a> (int socket)</td></tr>
<tr class="memdesc:aca795a02a79de001918ead83c14187d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve a client session based on the socket descriptor.  <br /></td></tr>
<tr class="separator:aca795a02a79de001918ead83c14187d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97039c09710c082d1ac8aba385b54758" id="r_a97039c09710c082d1ac8aba385b54758"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a97039c09710c082d1ac8aba385b54758">on_accept</a> (evutil_socket_t fd, short events, void *arg)</td></tr>
<tr class="memdesc:a97039c09710c082d1ac8aba385b54758"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function triggered upon a new client connection.  <br /></td></tr>
<tr class="separator:a97039c09710c082d1ac8aba385b54758"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77c68ffec48ac02ba3e1305ffd764a84" id="r_a77c68ffec48ac02ba3e1305ffd764a84"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a77c68ffec48ac02ba3e1305ffd764a84">write_file</a> (int client_fd, char *filepath)</td></tr>
<tr class="memdesc:a77c68ffec48ac02ba3e1305ffd764a84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes data received from the client into a file.  <br /></td></tr>
<tr class="separator:a77c68ffec48ac02ba3e1305ffd764a84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3490695419f11618b6a219db82551efa" id="r_a3490695419f11618b6a219db82551efa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3490695419f11618b6a219db82551efa">write_directory</a> (int client_fd, char *dir_path)</td></tr>
<tr class="memdesc:a3490695419f11618b6a219db82551efa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Recursively receives directories and their contents from the client and writes them to the server storage.  <br /></td></tr>
<tr class="separator:a3490695419f11618b6a219db82551efa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cd92b49ce90cafe27b5ea7c9758cd32" id="r_a7cd92b49ce90cafe27b5ea7c9758cd32"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7cd92b49ce90cafe27b5ea7c9758cd32">receive_upload</a> (int client_fd, const char *path)</td></tr>
<tr class="memdesc:a7cd92b49ce90cafe27b5ea7c9758cd32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Receive uploaded files or directories from the client.  <br /></td></tr>
<tr class="separator:a7cd92b49ce90cafe27b5ea7c9758cd32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6010e12aa9a090af3c8a4607ee18b449" id="r_a6010e12aa9a090af3c8a4607ee18b449"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a6010e12aa9a090af3c8a4607ee18b449">send_file_to_client</a> (int client_fd, const char *filename)</td></tr>
<tr class="memdesc:a6010e12aa9a090af3c8a4607ee18b449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a file from the server to the client.  <br /></td></tr>
<tr class="separator:a6010e12aa9a090af3c8a4607ee18b449"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37830428278db11632c28d0dcd53522b" id="r_a37830428278db11632c28d0dcd53522b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a37830428278db11632c28d0dcd53522b">create_folder</a> (int client_socket, const char *path)</td></tr>
<tr class="memdesc:a37830428278db11632c28d0dcd53522b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a folder (directory) at the specified path.  <br /></td></tr>
<tr class="separator:a37830428278db11632c28d0dcd53522b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e009de6f829a6d78d69a6af09567888" id="r_a7e009de6f829a6d78d69a6af09567888"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a7e009de6f829a6d78d69a6af09567888">send_directory</a> (int client_fd, const char *dir_path)</td></tr>
<tr class="memdesc:a7e009de6f829a6d78d69a6af09567888"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a directory and its contents (files and subdirectories) to the client.  <br /></td></tr>
<tr class="separator:a7e009de6f829a6d78d69a6af09567888"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f83ce8e6cc5329846f955610690fcde" id="r_a2f83ce8e6cc5329846f955610690fcde"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a2f83ce8e6cc5329846f955610690fcde">on_udp_broadcast</a> (evutil_socket_t fd, short events, void *arg)</td></tr>
<tr class="memdesc:a2f83ce8e6cc5329846f955610690fcde"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handles incoming UDP broadcast messages and responds accordingly.  <br /></td></tr>
<tr class="separator:a2f83ce8e6cc5329846f955610690fcde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d4397fd896ea562a0b9d00c962c4955" id="r_a8d4397fd896ea562a0b9d00c962c4955"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8d4397fd896ea562a0b9d00c962c4955">start_event_loop</a> (<a class="el" href="struct_server.html">Server</a> *server)</td></tr>
<tr class="memdesc:a8d4397fd896ea562a0b9d00c962c4955"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the event loop for the server.  <br /></td></tr>
<tr class="separator:a8d4397fd896ea562a0b9d00c962c4955"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00b69556a93ea448a696dd3bee0dc9ed" id="r_a00b69556a93ea448a696dd3bee0dc9ed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a00b69556a93ea448a696dd3bee0dc9ed">change_directory</a> (int client_fd, const char *newDir)</td></tr>
<tr class="memdesc:a00b69556a93ea448a696dd3bee0dc9ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Changes the current working directory of the client's session.  <br /></td></tr>
<tr class="separator:a00b69556a93ea448a696dd3bee0dc9ed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8c94c7c8296ea8fce88e2d90bacc6ed9" id="r_a8c94c7c8296ea8fce88e2d90bacc6ed9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a8c94c7c8296ea8fce88e2d90bacc6ed9">print_working_dir</a> (int client_fd)</td></tr>
<tr class="memdesc:a8c94c7c8296ea8fce88e2d90bacc6ed9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prints the current working directory of the client's session.  <br /></td></tr>
<tr class="separator:a8c94c7c8296ea8fce88e2d90bacc6ed9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a502db7566d51bcc34e85543483e34e28" id="r_a502db7566d51bcc34e85543483e34e28"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a502db7566d51bcc34e85543483e34e28">on_client_data</a> (evutil_socket_t fd, short events, void *arg)</td></tr>
<tr class="memdesc:a502db7566d51bcc34e85543483e34e28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function triggered when data is available from the client.  <br /></td></tr>
<tr class="separator:a502db7566d51bcc34e85543483e34e28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627" id="r_a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="memdesc:a3c04138a5bfe5d72780bb7e82a18e627"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main entry point of the program.  <br /></td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a97420ade78a111cee29f7845a84844e4" id="r_a97420ade78a111cee29f7845a84844e4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a97420ade78a111cee29f7845a84844e4">num_clients</a> = 0</td></tr>
<tr class="memdesc:a97420ade78a111cee29f7845a84844e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of currently connected clients.  <br /></td></tr>
<tr class="separator:a97420ade78a111cee29f7845a84844e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9bde7f3c6aa293ab04ee65bef57807c" id="r_ad9bde7f3c6aa293ab04ee65bef57807c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structclient__session.html">client_session</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad9bde7f3c6aa293ab04ee65bef57807c">clients</a> [<a class="el" href="constants_8h.html#ab8ba2d8f79af5ca38005742bbc29a927">MAX_CLIENT</a>]</td></tr>
<tr class="memdesc:ad9bde7f3c6aa293ab04ee65bef57807c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Array of client sessions.  <br /></td></tr>
<tr class="separator:ad9bde7f3c6aa293ab04ee65bef57807c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="struct_server.html" title="Represents a server instance and its associated data.">Server</a> implementation file. </p>
<p>This file implements the server setup, event loop handling, and client request management including file and directory handling.</p>
<p>It depends on "../include/server.h" for type definitions and function prototypes. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a00b69556a93ea448a696dd3bee0dc9ed" name="a00b69556a93ea448a696dd3bee0dc9ed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a00b69556a93ea448a696dd3bee0dc9ed">&#9670;&#160;</a></span>change_directory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void change_directory </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>client_fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>newDir</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Changes the current working directory of the client's session. </p>
<p>Validates the requested directory to ensure it doesn't escape the server's storage directory. Updates the client's current directory on success.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_fd</td><td>The client's file descriptor. </td></tr>
    <tr><td class="paramname">newDir</td><td>The requested new directory path (relative or absolute). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a37830428278db11632c28d0dcd53522b" name="a37830428278db11632c28d0dcd53522b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37830428278db11632c28d0dcd53522b">&#9670;&#160;</a></span>create_folder()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int create_folder </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>client_socket</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Creates a folder (directory) at the specified path. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td>The path where the folder should be created. </td></tr>
    <tr><td class="paramname">mode</td><td>The permissions for the new folder (e.g., 0700 for read/write/execute by the owner only). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on success, or -1 on failure with an error printed to stderr. </dd></dl>

</div>
</div>
<a id="aca795a02a79de001918ead83c14187d0" name="aca795a02a79de001918ead83c14187d0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aca795a02a79de001918ead83c14187d0">&#9670;&#160;</a></span>get_client_session_by_socket()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structclient__session.html">client_session</a> * get_client_session_by_socket </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>socket</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieve a client session based on the socket descriptor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">socket</td><td>The socket descriptor of the client. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pointer to the <a class="el" href="structclient__session.html" title="Represents a single client session.">client_session</a> or NULL if not found. </dd></dl>

</div>
</div>
<a id="a5a68295ef2b5f09c493e44512719ec84" name="a5a68295ef2b5f09c493e44512719ec84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5a68295ef2b5f09c493e44512719ec84">&#9670;&#160;</a></span>init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_server.html">Server</a> *</td>          <td class="paramname"><span class="paramname"><em>server</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>port</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>interface</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the server. </p>
<p>This function sets up the server's storage directory, creates a socket for the server (both TCP and UDP), and initializes the server structure with given interface and port.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>A pointer to the <a class="el" href="struct_server.html" title="Represents a server instance and its associated data.">Server</a> structure to be initialized. </td></tr>
    <tr><td class="paramname">port</td><td>The port number the server will listen on. </td></tr>
    <tr><td class="paramname">interface</td><td>The network interface name the server binds to. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627" name="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&#160;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>argc</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **</td>          <td class="paramname"><span class="paramname"><em>argv</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The main entry point of the program. </p>
<p>Initializes the server with given arguments and starts the event loop.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">argc</td><td>The argument count. </td></tr>
    <tr><td class="paramname">argv</td><td>The argument vector. Expected usage: ./program &lt;port&gt; &lt;interface&gt; </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 1337 on success, and may exit earlier on errors. </dd></dl>

</div>
</div>
<a id="a97039c09710c082d1ac8aba385b54758" name="a97039c09710c082d1ac8aba385b54758"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97039c09710c082d1ac8aba385b54758">&#9670;&#160;</a></span>on_accept()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void on_accept </td>
          <td>(</td>
          <td class="paramtype">evutil_socket_t</td>          <td class="paramname"><span class="paramname"><em>fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short</td>          <td class="paramname"><span class="paramname"><em>events</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>arg</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function triggered upon a new client connection. </p>
<p>Accepts a new client connection, initializes a <a class="el" href="structclient__session.html" title="Represents a single client session.">client_session</a> for it, and adds a new event to read data from this client.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The listening socket file descriptor. </td></tr>
    <tr><td class="paramname">events</td><td>The event flags. </td></tr>
    <tr><td class="paramname">arg</td><td>A pointer to the <a class="el" href="struct_server.html" title="Represents a server instance and its associated data.">Server</a> structure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a502db7566d51bcc34e85543483e34e28" name="a502db7566d51bcc34e85543483e34e28"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a502db7566d51bcc34e85543483e34e28">&#9670;&#160;</a></span>on_client_data()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void on_client_data </td>
          <td>(</td>
          <td class="paramtype">evutil_socket_t</td>          <td class="paramname"><span class="paramname"><em>fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short</td>          <td class="paramname"><span class="paramname"><em>events</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>arg</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function triggered when data is available from the client. </p>
<p>Callback function triggered when data is available from a client.</p>
<p>Parses and processes commands sent by the client such as upload, download, cd, and pwd.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The client's file descriptor. </td></tr>
    <tr><td class="paramname">events</td><td>The event flags. </td></tr>
    <tr><td class="paramname">arg</td><td>A pointer to the <a class="el" href="struct_server.html" title="Represents a server instance and its associated data.">Server</a> structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a2f83ce8e6cc5329846f955610690fcde" name="a2f83ce8e6cc5329846f955610690fcde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2f83ce8e6cc5329846f955610690fcde">&#9670;&#160;</a></span>on_udp_broadcast()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void on_udp_broadcast </td>
          <td>(</td>
          <td class="paramtype">evutil_socket_t</td>          <td class="paramname"><span class="paramname"><em>fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">short</td>          <td class="paramname"><span class="paramname"><em>events</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>arg</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handles incoming UDP broadcast messages and responds accordingly. </p>
<p>Callback function triggered when a UDP broadcast is received.</p>
<p>If the message is a DISCOVER_SERVER request, the server responds with its address and port. Also handles FILE_DISCOVER_SERVER requests by checking for file existence.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fd</td><td>The UDP socket file descriptor. </td></tr>
    <tr><td class="paramname">events</td><td>The event flags. </td></tr>
    <tr><td class="paramname">arg</td><td>A pointer to the <a class="el" href="struct_server.html" title="Represents a server instance and its associated data.">Server</a> structure. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a8c94c7c8296ea8fce88e2d90bacc6ed9" name="a8c94c7c8296ea8fce88e2d90bacc6ed9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c94c7c8296ea8fce88e2d90bacc6ed9">&#9670;&#160;</a></span>print_working_dir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void print_working_dir </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>client_fd</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prints the current working directory of the client's session. </p>
<p>Sends the client's current working directory path back to the client.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_fd</td><td>The client's file descriptor. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a7cd92b49ce90cafe27b5ea7c9758cd32" name="a7cd92b49ce90cafe27b5ea7c9758cd32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7cd92b49ce90cafe27b5ea7c9758cd32">&#9670;&#160;</a></span>receive_upload()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void receive_upload </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>client_fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Receive uploaded files or directories from the client. </p>
<p>Determines if the client is sending a file or a directory and then receives it accordingly using write_file or write_directory.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_fd</td><td>The client's file descriptor. </td></tr>
    <tr><td class="paramname">path</td><td>The path where the uploaded files/directories should be stored. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a7e009de6f829a6d78d69a6af09567888" name="a7e009de6f829a6d78d69a6af09567888"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7e009de6f829a6d78d69a6af09567888">&#9670;&#160;</a></span>send_directory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void send_directory </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>client_fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>dir_path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a directory and its contents (files and subdirectories) to the client. </p>
<p>Iterates through the directory, sending information about files and subdirectories. Uses send_file_to_client for files and send_directory recursively for directories.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_fd</td><td>The client's file descriptor. </td></tr>
    <tr><td class="paramname">dir_path</td><td>The path of the directory on the server to send. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a6010e12aa9a090af3c8a4607ee18b449" name="a6010e12aa9a090af3c8a4607ee18b449"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6010e12aa9a090af3c8a4607ee18b449">&#9670;&#160;</a></span>send_file_to_client()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void send_file_to_client </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>client_fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *</td>          <td class="paramname"><span class="paramname"><em>filename</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a file from the server to the client. </p>
<p>Reads the file from the given filename and sends it to the client in chunks. It also handles retransmission attempts if necessary.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_fd</td><td>The client's file descriptor. </td></tr>
    <tr><td class="paramname">filename</td><td>The path to the file on the server to be sent. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a1fd601017282ab132c57804ed86e1b94" name="a1fd601017282ab132c57804ed86e1b94"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd601017282ab132c57804ed86e1b94">&#9670;&#160;</a></span>setup_storage_dir()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup_storage_dir </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sets up the storage directory. </p>
<p>Checks if the storage directory exists. If it doesn't exist, creates the directory with permissions set to 0700. If the directory already exists, prints a message indicating its existence.</p>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a8d4397fd896ea562a0b9d00c962c4955" name="a8d4397fd896ea562a0b9d00c962c4955"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d4397fd896ea562a0b9d00c962c4955">&#9670;&#160;</a></span>start_event_loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void start_event_loop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_server.html">Server</a> *</td>          <td class="paramname"><span class="paramname"><em>server</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Starts the event loop for the server. </p>
<p>Starts the server's event loop.</p>
<p>Registers the TCP and UDP event callbacks and then dispatches the event loop, which will process client connections, incoming data, and UDP broadcasts.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">server</td><td>A pointer to the <a class="el" href="struct_server.html" title="Represents a server instance and its associated data.">Server</a> structure. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a id="a3490695419f11618b6a219db82551efa" name="a3490695419f11618b6a219db82551efa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3490695419f11618b6a219db82551efa">&#9670;&#160;</a></span>write_directory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_directory </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>client_fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>dir_path</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Recursively receives directories and their contents from the client and writes them to the server storage. </p>
<p>If the specified directory does not exist, it creates it. For each file or directory received, it writes the file or recursively processes the sub-directory.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_fd</td><td>The client's file descriptor. </td></tr>
    <tr><td class="paramname">dir_path</td><td>The directory path on the server where data should be written. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 1 on success or ERR on failure. </dd></dl>

</div>
</div>
<a id="a77c68ffec48ac02ba3e1305ffd764a84" name="a77c68ffec48ac02ba3e1305ffd764a84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77c68ffec48ac02ba3e1305ffd764a84">&#9670;&#160;</a></span>write_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int write_file </td>
          <td>(</td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>client_fd</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *</td>          <td class="paramname"><span class="paramname"><em>filepath</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes data received from the client into a file. </p>
<p>This function receives data chunks from the client until it encounters an end signal or times out. It then writes those chunks into the specified file.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client_fd</td><td>The client's file descriptor. </td></tr>
    <tr><td class="paramname">filepath</td><td>The path to the file on the server where data should be written. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 1 on success or ERR on failure. </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="ad9bde7f3c6aa293ab04ee65bef57807c" name="ad9bde7f3c6aa293ab04ee65bef57807c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9bde7f3c6aa293ab04ee65bef57807c">&#9670;&#160;</a></span>clients</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structclient__session.html">client_session</a> clients[<a class="el" href="constants_8h.html#ab8ba2d8f79af5ca38005742bbc29a927">MAX_CLIENT</a>]</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Array of client sessions. </p>
<p>This array holds the sessions for up to MAX_CLIENT clients. </p>

</div>
</div>
<a id="a97420ade78a111cee29f7845a84844e4" name="a97420ade78a111cee29f7845a84844e4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97420ade78a111cee29f7845a84844e4">&#9670;&#160;</a></span>num_clients</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int num_clients = 0</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The number of currently connected clients. </p>
<p>This variable tracks how many clients are currently connected to the server. </p><dl class="section warning"><dt>Warning</dt><dd>DO NOT MODIFY THIS VARIABLE, IT WILL BREAK EVERYTHING. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="server_8c.html">server.c</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
